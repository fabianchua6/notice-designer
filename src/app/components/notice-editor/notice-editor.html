<div class="editor-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-left">
      <button mat-icon-button routerLink="/" matTooltip="Back to Dashboard">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <div class="header-text">
        <h1>{{ isEditMode ? 'Edit Notice' : 'Create Notice' }}</h1>
        <p class="subtitle">{{ isEditMode ? 'Modify existing notice template' : 'Design a new notice template' }}</p>
      </div>
    </div>
    <div class="header-actions">
      <button mat-stroked-button (click)="toggleVariablePanel()" [class.active]="showVariablePanel">
        <mat-icon>code</mat-icon>
        Variables
      </button>
      <button mat-stroked-button (click)="resetForm()">
        <mat-icon>refresh</mat-icon>
        Reset
      </button>
      <button mat-stroked-button (click)="printNotice()" [disabled]="!title() || !content()">
        <mat-icon>print</mat-icon>
        Print / PDF
      </button>
      <button mat-flat-button color="primary" (click)="saveNotice()" [disabled]="!title() || !content()">
        <mat-icon>save</mat-icon>
        {{ isEditMode ? 'Update Notice' : 'Save Notice' }}
      </button>
    </div>
  </div>

  <!-- Variable Panel (Collapsible) -->
  @if (showVariablePanel) {
    <div class="variable-panel">
      <div class="panel-header">
        <mat-icon>data_object</mat-icon>
        <span>Template Variables</span>
        <span class="hint">Click a variable to insert it into your content</span>
      </div>
      <div class="variable-categories">
        @for (category of variableCategories; track category) {
          <div class="variable-category">
            <h4>{{ category }}</h4>
            <div class="variable-chips">
              @for (variable of getVariablesByCategory(category); track variable.key) {
                <button 
                  mat-stroked-button 
                  class="variable-chip"
                  (click)="insertVariable(variable)"
                  [matTooltip]="'Sample: ' + variable.sampleValue">
                  <mat-icon>add</mat-icon>
                  {{ variable.label }}
                  <code>{{ variable.key }}</code>
                </button>
              }
            </div>
          </div>
        }
      </div>
    </div>
  }

  <!-- Editor Layout -->
  <div class="editor-layout">
    <!-- Left Panel - Form -->
    <div class="form-panel">
      <mat-card>
        <mat-card-header>
          <mat-icon mat-card-avatar class="header-icon">edit_note</mat-icon>
          <mat-card-title>Notice Content</mat-card-title>
          <mat-card-subtitle>Use the rich text editor to format your notice</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Notice Title</mat-label>
            <input matInput [(ngModel)]="title" placeholder="e.g., Income Tax Assessment Notice">
            <mat-icon matSuffix>title</mat-icon>
          </mat-form-field>
          
          <!-- TinyMCE Rich Text Editor -->
          <div class="editor-wrapper">
            <label class="editor-label">Notice Content</label>
            <editor
              [(ngModel)]="content"
              [init]="editorConfig"
              apiKey="no-api-key">
            </editor>
            <div class="editor-hint">
              <mat-icon>info</mat-icon>
              <span>Use double curly braces for dynamic content. Click "Variables" to see available options.</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
    
    <!-- Right Panel - Preview -->
    <div class="preview-panel">
      <div class="preview-header">
        <mat-icon>visibility</mat-icon>
        <span>Rendered Preview</span>
        <span class="preview-badge">With Sample Data</span>
      </div>
      <div class="preview-content html-preview">
        <div class="rendered-document">
          <!-- IRAS Header -->
          <div class="doc-header">
            <div class="iras-brand">
              <span class="logo">IRAS</span>
              <span class="ministry">Inland Revenue Authority of Singapore</span>
            </div>
          </div>
          
          <!-- Title -->
          <div class="doc-title">{{ title() || 'Untitled Notice' }}</div>
          
          <!-- Content with variables replaced -->
          <div class="doc-content" [innerHTML]="getPreviewContent()"></div>
        </div>
      </div>
    </div>
  </div>
</div>
