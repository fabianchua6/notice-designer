<div class="editor-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-left">
      <button mat-icon-button routerLink="/" matTooltip="Back to Dashboard">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <div class="header-text">
        <h1>{{ isEditMode ? 'Edit Notice' : 'Create Notice' }}</h1>
        <p class="subtitle">{{ isEditMode ? 'Modify existing notice template' : 'Design a new notice template' }}</p>
      </div>
    </div>
    <div class="header-actions">
      <button mat-stroked-button (click)="toggleComponentsPanel()" [class.active]="showComponentsPanel">
        <mat-icon>widgets</mat-icon>
        Components
      </button>
      <button mat-stroked-button (click)="toggleVariablePanel()" [class.active]="showVariablePanel">
        <mat-icon>code</mat-icon>
        Variables
      </button>
      <button mat-stroked-button (click)="resetForm()">
        <mat-icon>refresh</mat-icon>
        Reset
      </button>
      <button mat-stroked-button (click)="printNotice()" [disabled]="!title() || !content()">
        <mat-icon>print</mat-icon>
        Print / PDF
      </button>
      <button mat-flat-button color="primary" (click)="saveNotice()" [disabled]="!title() || !content()">
        <mat-icon>save</mat-icon>
        {{ isEditMode ? 'Update Notice' : 'Save Notice' }}
      </button>
    </div>
  </div>

  <!-- Variable Panel (Collapsible) -->
  @if (showVariablePanel) {
    <div class="variable-panel">
      <div class="panel-header">
        <mat-icon>data_object</mat-icon>
        <span>Template Variables</span>
        <span class="hint">Click a variable to insert it into your content</span>
      </div>
      <div class="variable-categories">
        @for (category of variableCategories; track category) {
          <div class="variable-category">
            <h4>{{ category }}</h4>
            <div class="variable-chips">
              @for (variable of getVariablesByCategory(category); track variable.key) {
                <button 
                  mat-stroked-button 
                  class="variable-chip"
                  (click)="insertVariable(variable)"
                  [matTooltip]="'Sample: ' + variable.sampleValue">
                  <mat-icon>add</mat-icon>
                  {{ variable.label }}
                  <code>{{ variable.key }}</code>
                </button>
              }
            </div>
          </div>
        }
      </div>
    </div>
  }

  <!-- Reusable Components Panel (Collapsible) -->
  @if (showComponentsPanel) {
    <div class="components-panel">
      <div class="panel-header">
        <mat-icon>widgets</mat-icon>
        <span>Reusable Components</span>
        <span class="hint">Click a component to insert it into your content</span>
      </div>
      <div class="component-categories">
        @for (category of componentLibrary; track category.category) {
          <div class="component-category">
            <h4>
              <mat-icon>{{ category.icon }}</mat-icon>
              {{ category.category }}
            </h4>
            <div class="component-items">
              @for (item of category.items; track item.name) {
                <button 
                  mat-stroked-button 
                  class="component-item"
                  (click)="insertComponent(item)"
                  [matTooltip]="'Insert ' + item.name">
                  <mat-icon>{{ item.icon }}</mat-icon>
                  <span>{{ item.name }}</span>
                </button>
              }
            </div>
          </div>
        }
      </div>
    </div>
  }

  <!-- Editor Layout -->
  <div class="editor-layout">
    <!-- Left Panel - Form -->
    <div class="form-panel">
      <mat-card>
        <mat-card-header>
          <mat-icon mat-card-avatar class="header-icon">edit_note</mat-icon>
          <mat-card-title>Notice Content</mat-card-title>
          <mat-card-subtitle>Use the rich text editor to format your notice</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Notice Title</mat-label>
            <input matInput [(ngModel)]="title" placeholder="e.g., Income Tax Assessment Notice">
            <mat-icon matSuffix>title</mat-icon>
          </mat-form-field>
          
          <!-- TinyMCE Rich Text Editor (Self-hosted, no API key needed) -->
          <div class="editor-wrapper">
            <label class="editor-label">Notice Content</label>
            <editor
              [(ngModel)]="content"
              [init]="editorConfig">
            </editor>
            <div class="editor-hint">
              <mat-icon>info</mat-icon>
              <span>Use double curly braces for dynamic content. Click "Variables" to see available options.</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
    
    <!-- Right Panel - Preview -->
    <div class="preview-panel">
      <div class="preview-header">
        <mat-icon>visibility</mat-icon>
        <span>Document Preview</span>
        <button mat-stroked-button class="toggle-data-btn" (click)="toggleSampleData()" [matTooltip]="showSampleData ? 'Click to show variable names' : 'Click to show sample values'">
          <mat-icon>{{ showSampleData ? 'data_object' : 'text_fields' }}</mat-icon>
          {{ showSampleData ? 'Sample Data' : 'Variables' }}
        </button>
        <div class="zoom-controls">
          <button mat-icon-button (click)="zoomOut()" matTooltip="Zoom Out">
            <mat-icon>remove</mat-icon>
          </button>
          <span class="zoom-level">{{ zoom }}%</span>
          <button mat-icon-button (click)="zoomIn()" matTooltip="Zoom In">
            <mat-icon>add</mat-icon>
          </button>
        </div>
      </div>
      <div class="preview-content a4-preview">
        <div class="pages-wrapper" [style.transform]="'scale(' + (zoom/100) + ')'" [style.transform-origin]="'top center'">
          <!-- A4 Page -->
          <div class="a4-page">
            <!-- Page Content -->
            <div class="page-content">
              <!-- IRAS Header -->
              <div class="iras-header">
                <div class="header-left">
                  <p class="tax-ref">Tax Reference Number: <strong>S1234567A</strong></p>
                  <p class="date">Date: {{ getCurrentDate() }}</p>
                </div>
                <div class="header-right">
                  <div class="iras-logo">
                    <img src="assets/irasLogo.png" alt="IRAS Logo" height="50">
                  </div>
                  <div class="iras-text">
                    <span class="iras-name">INLAND REVENUE</span>
                    <span class="iras-name">AUTHORITY</span>
                    <span class="iras-name">OF SINGAPORE</span>
                  </div>
                </div>
              </div>
              
              <!-- Document Title -->
              @if (title()) {
                <div class="doc-title-bar">
                  {{ title() }}
                </div>
              }
              
              <!-- Content with rendered HTML and sample data -->
              <div class="doc-body" [innerHTML]="getPreviewContent()"></div>
            </div>
            
            <!-- Page Footer -->
            <div class="page-footer">
              <p>Website: <a href="#">www.iras.gov.sg</a> â€¢ myTax Portal: <a href="#">mytax.iras.gov.sg</a></p>
              <p>Tel: 6351 3551</p>
              <p class="page-number">Page 1 of 1</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
